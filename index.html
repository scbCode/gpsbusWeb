<!DOCTYPE html>
<html>
  <head>
      <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="appwarp.min.js"></script>
        <script src="jquery-1.10.2.min.js"></script>
    <style>
       #map {
        height: 400px;
        width: 100%;
       }
    </style>
  </head>
  <body>
    <h3>My Google Maps Demo</h3>
    <div id="map"></div>



    <script>

            var _warpclient;
            var nameId = "0000";
            var roomsText = "";
            var inRoom = false;
            var roomId = "1521598624";

            var apiKey = "7e3ed36d2af8881d64a6dc61bf8fcb5a628c673088ae592915134f82b1a68c18";
            var secreteKey = "27e844a911519c4d01d5ad6a91edc7ac94465a64f8ccfce911f41394f86b71cf";
            function onConnectDone(res)
            {
                    _warpclient.getAllRooms();

            }
            
            function onGetAllRoomsDone(rooms)
            {
              console.log("conect");

                // roomsText = "";
                // $("#roomsList").html(roomsText);
                for(var i=0; i<rooms.getRoomIds().length; ++i)
                {
                      console.log(_warpclient.getLiveRoomInfo("1521598624"));
                }
                
            }
            
            function onGetLiveRoomInfo(room)
            {
                // roomsText += '<li><a href="#" onClick="joinRoom(\''+room.getRoom().getRoomId()+'\')">' + room.getRoom().getName() + '</a></li>';
                // $("#roomsList").html(roomsText);
                // $("#chat").html("Select a room");
            }
            
            function onJoinRoomDone(room)
            {
                if(room.getResult() == AppWarp.ResultCode.Success)
                {
                    _warpclient.subscribeRoom(room.getRoomId());
                }
            }
            
            function onSubscribeRoomDone(room)
            {
                if(room.getResult() == AppWarp.ResultCode.Success)
                {
                    inRoom = true;
                    roomId = room.getRoomId();
                //     $("#roomInfo").html("Joined Room : " + room.getName());
                //     $("#chat").html("");
                //     $("#roomsList").html('<button id="leaveBtn" onClick="leaveRoom()" type="button" class="btn btn-primary">Leave Room</button>');
                }
            }
            
            function onLeaveRoomDone(room)
            {
                if(room.getResult() == AppWarp.ResultCode.Success)
                {
                    _warpclient.unsubscribeRoom(room.getRoomId());
                }
            }
            
            function onUnsubscribeRoomDone(room)
            {
                if(room.getResult() == AppWarp.ResultCode.Success)
                {
                    inRoom = false;
                    _warpclient.getAllRooms();
                //     $("#chat").html("");
                }
            }
            
            function onChatReceived(chat)
            {
                // $("#chat").html("<dt class='text-danger'>"+chat.getSender() + "</dt><dd class='text-primary'>" + chat.getChat() + "</dd>" + $("#chat").html());
            }
            
            function joinRoom(id)
            {
                if(inRoom == false)
                {
                    _warpclient.joinRoom(id);
                }
            }
            
            function leaveRoom()
            {
                _warpclient.leaveRoom(roomId);
                // $("#roomInfo").html("Connected");
            }

$(document).ready(function(){
         
                        AppWarp.WarpClient.initialize(apiKey, secreteKey);

                        _warpclient = AppWarp.WarpClient.getInstance();
                        _warpclient.setResponseListener(AppWarp.Events.onConnectDone, onConnectDone);
                        _warpclient.setResponseListener(AppWarp.Events.onGetAllRoomsDone, onGetAllRoomsDone);
                        _warpclient.setResponseListener(AppWarp.Events.onGetLiveRoomInfoDone, onGetLiveRoomInfo);
                        _warpclient.setResponseListener(AppWarp.Events.onJoinRoomDone, onJoinRoomDone);
                        _warpclient.setResponseListener(AppWarp.Events.onSubscribeRoomDone, onSubscribeRoomDone);
                        _warpclient.setResponseListener(AppWarp.Events.onLeaveRoomDone, onLeaveRoomDone);
                        _warpclient.setResponseListener(AppWarp.Events.onUnsubscribeRoomDone, onUnsubscribeRoomDone);
                        _warpclient.setNotifyListener(AppWarp.Events.onChatReceived, onChatReceived);
                        _warpclient.connect(nameId);
                   
                });


    initMap() ;
      function initMap() {
        var uluru = {lat: -25.363, lng: 131.044};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: uluru,
           mapTypeId: google.maps.MapTypeId.ROADMAP
        });
      var  marker = new google.maps.Marker({
          position: uluru,
          map: map
        });

            google.maps.event.addListener(map, 'click', function(me) {
            var coord = [me.latLng.lat(), me.latLng.lng()];

            transition(coord);

        });
           

    var numDeltas = 100;
    var delay = 10; //milliseconds
    var i = 0;
    var deltaLat;
    var deltaLng;
    var position = [43, -89];


        function transition(result){
        i = 0;
        deltaLat = (result[0] - position[0])/numDeltas;
        deltaLng = (result[1] - position[1])/numDeltas;
        moveMarker();
    }
    
    function moveMarker(){
        position[0] += deltaLat;
        position[1] += deltaLng;
        var latlng = new google.maps.LatLng(position[0], position[1]);
         marker.setPosition(latlng);
        if(i!=numDeltas){
            i++;
            setTimeout(moveMarker, delay);
        }
    }
    }

    </script>


    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC12FBPLkL99C7u3_Hx2-2K2rCvKgwU0W4&callback=initMap">
    </script>
  </body>
</html>

